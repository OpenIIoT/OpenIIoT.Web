<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Security
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
    <li><a href="#">Administration</a></li>
    <li class="active">Security</li>
  </ol>
</section>

<!-- Main content -->
<section class="content container-fluid">
  <!-- users list -->
  <div class="row">
    <div class="col-xs-12">
      <div class="box box-primary">
        <div class="box-header">
          <i class="fa fa-group"></i>

          <h3 class="box-title">Users</h3>
        </div>
        <div class="box-body table-responsive">
          <table id="users" class="table table-hover">
            <tr>
              <th>Username</th>
              <th>Full Name</th>
              <th>Email</th>
              <th>Role</th>
              <th style="width: 10px"></th>
              <th style="width: 10px"></th>
            </tr>
            <!-- rows inserted via javascript -->
          </table>
          <button type="button" style="width: 200; margin-top: 30px" class="pull-right btn btn-primary"><i class="fa fa-plus" aria-hidden="true"/> New User</button>
        </div>
        <!-- /.box-body-->
      </div>
      <!-- /.box -->

    </div>
    <!-- /.col -->

  </div>
  <!-- /users list -->

  <!-- session list -->
  <div class="row">
    <div class="col-xs-12">
      <div class="box">
        <div class="box-header">
          <i class="fa fa-id-card"></i>

          <h3 class="box-title">Active Sessions</h3>
        </div>
        <div class="box-body table-responsive">
          <table id="sessions" class="table table-hover">
            <tr>
              <th>Token</th>
              <th>Username</th>
              <th>Created</th>
              <th>Expires</th>
              <th style="width: 10px"></th>
            </tr>
            <!-- rows inserted via javascript -->
          </table>
        </div>
        <!-- /.box-body-->
      </div>
      <!-- /.box -->

    </div>
    <!-- /.col -->

  </div>
  <!-- /session list -->
</section>
<!-- /.content -->


<script type="text/javascript">
  var users = [];
  var sessions = [];

  $(document).ready(function () {
    fetchUsers();
    fetchSessions();
  });

  function fetchUsers() {
    $("#users tbody:not(:first)").empty();
    $.get("api/v1/security/users").done(function (data) {
      users = data;

      users.forEach((element) => {
        var row = $("<tr>");

        row.append($("<td>" + element.Name + "</td>"))
          .append($("<td>" + element.DisplayName + "</td>"))
          .append($("<td>" + element.Email + "</td>"))
          .append($("<td>" + element.Role + "</td>"))
          .append($("<td><i class='fa fa-pencil' aria-hidden='true'/></i>"))
          .append($("<td><i class='fa fa-trash' aria-hidden='true'/></i>"));

        $("#users tbody").append(row);
      })
    })
  }

  function fetchSessions() {
    $("#sessions tbody:not(:first)").empty();

    $.get("api/v1/security/sessions").done(function (data) {
      sessions = data;

      sessions.forEach((element) => {
        var created = new Date(parseInt(element.Created.substr(6))).toTimeString().split(' ')[0];
        var expires = new Date(parseInt(element.Expires.substr(6))).toTimeString().split(' ')[0];
        var row = $("<tr>");

        row
          .append($("<td>" + element.Token.substring(0, 25) + "... <i class='fa fa-info-circle' aria-hidden='true'/></td>"))
          .append($("<td>" + element.User.Name + "</td>"))
          .append($("<td>" + created + "</td>"))
          .append($("<td>" + expires + "</td>"))
          .append($("<td><i class='fa fa-trash' aria-hidden='true'/></i>"));

        $("#sessions tbody").append(row);
      })
    })
  }
</script>